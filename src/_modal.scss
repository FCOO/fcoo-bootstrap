/************************************************************
MODAL

Adjusting size etc. to have modal in normal and small size 
and jusing standard header, buttons and sizes

If the height (and width) of the content is variable (eq. accordion) the class
.modal-flex is added to .modal given
    width : max-width = $modal-md-rem (or $modal-lg-rem)
    height: As default but with fixed height for small devices to prevent rapidly change of height

************************************************************/

//Calculate padding for modal-body when it is inside a jquery-scroll-container
//Using $scroll-size and $scrollbar-margin from jquery-scroll-container.

//Minimum padding = scrollbar width plus extra margin
$min-padding: $scroll-size + $scrollbar-margin-extended; 

//Padding for fixed content when modal-body has scrolling
$modal-body-fixed-scroll-padding-x   : max( $content-padding-x   , $min-padding);
$modal-body-fixed-scroll-padding-x-sm: max( $content-padding-x-sm, $min-padding);

//Setting the different padding to be the different between original-padding and scroll-margin (and >= 0)
$modal-body-scroll-padding-y: max( 0, max( $content-padding-y, $min-padding) - $scroll-size );  
$modal-body-scroll-padding-x: max( 0, $modal-body-fixed-scroll-padding-x - $scroll-size );  

$modal-body-scroll-padding-y-sm: max( 0, max( $content-padding-y-sm, $min-padding) - $scroll-size );  
$modal-body-scroll-padding-x-sm: max( 0, $modal-body-fixed-scroll-padding-x-sm - $scroll-size );  

/****************************************************
Icons for modal header inside a container
<i class="modal-header-icon modal-header-icon-XX [first-icon] [hidden][disabled]"/>
****************************************************/
.modal-header-icon-container {
    $font-size: 1.1em;
    $padding   : $btn-padding-x-sm / 2;

    margin-left : auto;
    margin-right: - $padding;

    .modal-icon {
        font-family: 'modal-header-icons' !important;

        //Default font-icon style
        speak: none;
        font-style: normal;
        font-weight: normal;
        font-variant: normal;
        text-transform: none;
        line-height: 1;


        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;

        //Common style
        font-size  : $font-size;
        color      : $close-color;
        text-shadow: $close-text-shadow;
        opacity    : .5;
        cursor     : default;

        margin : 0;
        padding: $padding;

        &:not(.disabled):hover {
            @include hover-focus {
                color: $close-color;
                text-decoration: none;
                opacity: .75;
            }
            &:active { 
                opacity: .9;
           }
        }

        //modal-icon-extend and modal-icon-diminish: Icon to extend and diminish the modal
        &.modal-icon-extend {
            &:before   { content: '\ea41'; }
            .modal-extendable.modal-extended & { display: none; }
        }

        &.modal-icon-diminish {
            &:before { content: '\ea43'; }
            .modal-extendable:not(.modal-extended) & { display: none; }        
        }

        //Special version for close-icon
        &.modal-icon-close {
            &:before { content: '\ed65'; }
            &:hover {
                &:before { content: "\ed66"; }
                @include hover-focus {
                    color  : $red;
                    opacity: 1;
                }
                &:active { 
                    color: darken($red, $darken-active-percent);
                }
            } 
        }

    } //end of .modal-icon {
}



.modal, .modal-inline {
    $modal-max-height: calc(100vh - #{2*$modal-dialog-margin});

    $modal-max-width : calc(100vw - #{2*$modal-dialog-margin});

    .modal-dialog {

        display        : flex;
        flex-direction : column;

        justify-content: center;
    
        //On small screens the modal is placed at the top
        @media (max-height: 575px) {
            justify-content: flex-end; //flex-start;
        }


        margin   : $modal-dialog-margin auto;
        
        min-height: $modal-max-height; 

        max-width: $modal-max-width;
        width    : $modal-sm-rem;

        html.medium-up &, &.modal-flex {
            width: $modal-md-rem;
        }

        .modal-content { 
            min-height: 100%; //Bug fix for IE11
            max-height: $modal-max-height; //Modal window height adjust to contents
        }

        //Size of .jquery-scroll-container in fixed in flex mode but only for the .jquery-scroll-container containing the modal-content
        &:not(.modal-flex) .modal-content .modal-body > .jquery-scroll-container {
            width: calc( #{$modal-sm-rem} - 2*#{$modal-content-border-width} - 2*#{$modal-body-fixed-scroll-padding-x} ); 
            margin-left : auto;
            margin-right: auto; 
        }

        &.modal-flex .modal-content .modal-body > .jquery-scroll-container {
            width: auto;
        }

        //Force fading opacity
        opacity: 0;
        transition: opacity 0.3s linear;
    }

    &.show {
        .modal-dialog { opacity: 1; }
    }


    //Overwrite Bootstrap media-query setting max-width = 300px for modal-sm but only for non inline modals
    &:not(.modal-inline).modal-sm {
        max-width: none !important;
    }


    //No box-shadow on modal-content when inside a modal-inline
    &.modal-inline .modal-content {
        box-shadow: none;
    }
}

//Adjust header, fixed-body, body and footer
.modal, .modal-inline {

    font-size: 1rem; //To avoid overwrite from other container
    .modal-content {
        .modal-header {
            flex-shrink: 0; //Only .modal-body is shrink
            flex-grow  : 0; //Only .modal-body is growing
            @include header-variant(); 
            @include header-color(); 
        }
        //Add cursor: default to all header children when modal is extendable
        &.modal-extendable .modal-header * {
            cursor: default; 
        }

        .modal-body-fixed {
            flex-shrink: 0; //Only .modal-body is shrink
            flex-grow  : 0; //Only .modal-body is growing
            overflow   : hidden; 
            @include content-padding();

            &:empty { display: none; }
        }
        .modal-body {
            flex-shrink: 1; //Only .modal-body is shrink
            flex-grow  : 1; //Only .modal-body is growing
            @include content-padding();
            @include border-radius( calc( #{$border-radius-lg} - #{$modal-content-border-width} ) );    
        }

        .modal-footer-header { //Named modal-footer-header since Bootstrap uses modal-footer for the div with buttons
            flex-shrink: 0; //Only .modal-body is shrink
            flex-grow  : 0; //Only .modal-body is growing
            @include footer-variant();

            //Remove top-border to modal-footer it modal-footer-header isn't empty
            &:not(:empty) + .modal-footer {
                border-top: none; 
            }
        }

        .modal-footer {
            flex-shrink: 0; //Only .modal-body is shrink
            flex-grow  : 0; //Only .modal-body is growing
            padding: $btn-padding-x;

            &:empty,
            &.modal-footer-vertical:empty { 
                display: none; 
            }

            &.modal-footer-vertical {
                display         : flex;
                flex-direction  : column;
                align-items     : center;
                justify-content : center;
                > * { margin: 0;}
                > *:not(:first-child) { margin-top: .25rem; }
            }
        }
    }
}


//size='small'
.modal.modal-sm,
.modal-inline.modal-sm {
    .modal-content {
        .modal-header {
            @include header-variant-sm(); 
        }
        .modal-body,
        .modal-body-fixed {
            @include content-padding-sm();
        }
        .modal-footer-header { //Named modal-footer-header since Bootstrap uses modal-footer for the div with buttons
            @include footer-variant-sm();
        }

        .modal-footer {
            //padding: $btn-padding-x-sm;
        }
    }
}


//Adjust padding-left and padding-right if the body is a scroll
.modal, .modal-inline {
    .modal-body-fixed.scrollbar-vertical{
        padding-left : $modal-body-fixed-scroll-padding-x;
        padding-right: $modal-body-fixed-scroll-padding-x;
    }
    .modal-body.scrollbar-vertical {
        padding-left : $modal-body-scroll-padding-x;
        padding-right: $modal-body-scroll-padding-x;
    }
    .modal-body.scrollbar-horizontal {
        padding-bottom: $modal-body-scroll-padding-y;
    }
}

.modal.modal-sm,
.modal-inline.modal-sm {
    .modal-body-fixed.scrollbar-vertical {
        padding-left : $modal-body-fixed-scroll-padding-x-sm;
        padding-right: $modal-body-fixed-scroll-padding-x-sm;
    }

    .modal-body.scrollbar-vertical {
        padding-left : $modal-body-scroll-padding-x-sm;
        padding-right: $modal-body-scroll-padding-x-sm;
    }
    .modal-body.scrollbar-horizontal {
        padding-bottom: $modal-body-scroll-padding-y-sm;
    }
}



//No top- or bottom padding in modal-body and modal-body-fixed
.modal, 
.modal-inline,
.modal.modal-sm,
.modal-inline.modal-sm {
    &.no-vertical-padding {
        .modal-body-fixed, .modal-body {
            padding-top   : 0;
            padding-bottom: 0;
        }
    }
}
